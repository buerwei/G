<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>梁志威</title>
	<script src="js/flexible.js"></script>
	<script src="js/flexible_css.js"></script>
	<script src="js/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="js/touch.js"></script>
	<script type="text/javascript" src="js/fastclick.js"></script>
	<script type="text/javascript" src="js/jQueryRotate.2.2.js"></script>
	<link rel="stylesheet" href="css/G.css">
	<link rel="stylesheet" href="css/animate.css">
</head>
<body>
	<div id="one">
		<img src="img/bg4.jpg">
		<img src="img/logo.png">
		<img src="" data-src="img/gti.png" class="photo gti">
		<div id="time">
			<span id="per">0%</span>
			<p></p>
			<img src="img/run.png">
		</div>
	</div>
	<div id="two">
		<img src="" data-src="img/bg2.png" class="photo"> 
		<img src="" data-src="img/logo2.png" class="photo logo2 animated bounceInLeft">
		<p class="animated bounceInLeft">精彩视频，先睹为快</p>
	</div>
	<div id="three">
		<img src="" data-src="img/bg3.jpg" class="photo">
		<img src="" data-src="img/logo3.png" class="photo animated flipInX">
		<a href="javascript:void(0)"><img src="" data-src="img/first.png" class="photo btn animated infinite pulse"></a>
		<a href="javascript:void(0)"><img src="" data-src="img/informbtn.png" class="photo"></a>
		<div id="inform">
			<img src="" data-src="img/inform.png" class="photo">
			<img src="" data-src="img/return.png" class="photo">
		</div>
	</div>
	<div id="first">
		<img src="" data-src="img/bg3.jpg" class="photo">
		<img src="" data-src="img/logo2.png" class="photo logo2 animated zoomIn">
		<img src="" data-src="img/gift-1.png" class="photo animated zoomIn">
		<img src="" data-src="img/second.png" class="photo btn animated infinite pulse">
	</div>
	<div id="second">
		<img src="" data-src="img/bg3.jpg" class="photo">
		<img src="" data-src="img/logo2.png" class="photo logo2 animated zoomIn">
		<img src="" data-src="img/gift-2.png" class="photo animated zoomIn">
		<img src="" data-src="img/third.png" class="photo btn animated infinite pulse">
	</div>
	<div id="third">
		<img src="" data-src="img/bg3.jpg" class="photo">
		<img src="" data-src="img/logo2.png" class="photo logo2 animated zoomIn">
		<img src="" data-src="img/gift-3.png" class="photo animated lightSpeedIn">
		<a href="javascript:void(0)"><img src="" data-src="img/book.png" class="photo"></a>
	</div>
	<div id="lucky">
		<img src="" data-src="img/bg3.jpg" class="photo">
		<img src="" data-src="img/logo2.png" class="photo logo2 animated zoomIn">
		<img src="" data-src="img/dish.png" class="photo" id="dish">
		<img src="" data-src="img/needle.png" class="photo">
		<img src="" data-src="img/start.png" class="photo" id="start">
		<div id="sorry">
			<img src="" data-src="img/sorry.png" class="photo">
			<img src="" data-src="img/share.png" class="photo">
		</div>
		<div id="share">
			<img src="" data-src="img/share-2.png" class="photo">
		</div>
		<div id="firstP">
			<img src="" data-src="img/first-prize.png" class="photo">
			<img src="" data-src="img/submit.png" class="photo submit">
		</div>
		<div id="secondP">
			<img src="" data-src="img/second-prize.png" class="photo">
			<img src="" data-src="img/submit.png" class="photo submit">
		</div>
		<div id="thirdP">
			<img src="" data-src="img/third-prize.png" class="photo">
			<img src="" data-src="img/submit.png" class="photo submit">
		</div>
	</div>
	<script type="text/javascript">
		var imgList = document.getElementsByClassName('photo');
		var per = document.getElementById('per');
		var imgBox = [];
		var num=0;
		FastClick.attach(document.body);
		for(var i = 0;i<imgList.length;i++){
			var timeW = $("#time p").width();
			imgBox[i] = new Image();
			imgBox[i].src = imgList[i].getAttribute('data-src');
			imgBox[i].onload = function() {
				num++;
				var percent = Math.floor(num/imgList.length *100);
				$("#time p").width(timeW*(num/imgList.length));
				$("#time img").css({
					left:timeW*(num/imgList.length) 
				})
				$("#per").css({
					left:timeW*(num/imgList.length)
				})
				per.innerHTML = percent+"%";
				if(num==imgList.length){
					for(var j=0;j<imgList.length;j++){
						imgList[j].src = imgBox[j].src;
					}
					$("#time").hide();
					$("#one img:nth-child(2)").addClass("animated fadeInDownBig");
					$(".gti").addClass("animated rotateIn");
				}
			}
		}
		document.addEventListener('touchmove', function(e) {
			e.preventDefault();
		})
		touch.on($("#one"),"swipeup",function(e){
			$("#one").hide();
			$("#two").show();
			e.stopPropagation();
		})
		touch.on($("#two"),"swipeup",function(e){
			$("#two").hide();
			$("#three").show();
			e.stopPropagation();
		})
		$("#three a:nth-child(4)").on("touchstart",function(){
			$("#inform").show();
			
		})
		$("#inform img:nth-child(2)").on("touchstart",function(){
			$("#inform").hide();
		})
		$("#three .btn").on("touchstart",function(){
			$("#three").hide();
			$("#first").show();
		})
		$("#first .btn").on("touchstart",function(){
			$("#first").hide();
			$("#second").show();
		})
		$("#second .btn").on("touchstart",function(){
			$("#second").hide();
			$("#third").show();
		})
		$("#third a:nth-child(4)").on("touchstart",function(){
			$("#third").hide();
			$("#lucky").show();
		})
		$("#sorry img:nth-child(2)").on("touchstart",function(){
			$("#share").show();
		})
		$(function(){
    var timeOut = function(){  //超时函数
        $("#lotteryBtn").rotate({
            angle:0, 
            duration: 10000, 
            animateTo: 2160,  //这里是设置请求超时后返回的角度，所以应该还是回到最原始的位置，2160是因为我要让它转6圈，就是360*6得来的
            callback:function(){
                alert('网络超时')
            }
        }); 
    }; 
    var rotateFunc = function(awards,angle,data){  //awards:奖项，angle:奖项对应的角度，text:提示文字
        $('#dish').stopRotate();
        $("#dish").rotate({
            angle:0, 
            duration: 5000, 
            animateTo: angle+1440, //angle是图片上各奖项对应的角度，1440是我要让指针旋转4圈。所以最后的结束的角度就是这样子^^
            callback:function(){
                succFn(data);
            }
        }); 
    };
    $("#start").on("click",function(){
        var time = 1;
        if(time==0){
            timeOut(); //网络超时
        }
        if(time==1){
            var data = [1,2,3,0]; //返回的数组
                data = data[Math.floor(Math.random()*data.length)];
            if(data==1){
                rotateFunc(1,-75,data)
            }
            if(data==2){
                var angle = [135,45];
                angle = angle[Math.floor(Math.random()*angle.length)]
                rotateFunc(2,angle,data)
            }
            if(data==3){
                var angle = [15,195,-45];
                angle = angle[Math.floor(Math.random()*angle.length)]
                rotateFunc(3,angle,data)
            }
            if(data==0){
                var angle = [75,105,165,-15,-105,-135];
                    angle = angle[Math.floor(Math.random()*angle.length)]
                rotateFunc(0,angle,data)
            }
        }
    })
    function succFn(data){
        switch(data){
            case 0:
                $("#sorry").show();
                break;
            case 1:
                $("#firstP").show();
                break;
            case 2:
                $("#secondP").show();
                break;
            case 3:
            	$("#thirdP").show();
                break;
        }
    }
})
	</script>
</body>
</html>